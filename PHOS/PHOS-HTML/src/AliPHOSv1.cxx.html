<!DOCTYPE HTML PUBLIC "-// IETF/DTD HTML 2.0// EN">
<html>
<!--                                             -->
<!-- Author: ROOT team (rootdev@hpsalo.cern.ch)  -->
<!--                                             -->
<!--   Date: Thu Mar  9 00:11:53 2000            -->
<!--                                             -->
<head>
<title>AliPHOSv1 - source file</title>
<link rev=made href="mailto:rootdev@root.cern.ch">
<meta name="rating" content="General">
<meta name="objecttype" content="Manual">
<meta name="keywords" content="software development, oo, object oriented, unix, x11, motif, windows nt, c++, html, rene brun, fons rademakers">
<meta name="description" content="ROOT - An Object Oriented Framework For Large Scale Data Analysis.">
</head>
<body BGCOLOR="#ffffff" LINK="#0000ff" VLINK="#551a8b" ALINK="#ff0000" TEXT="#000000">
<a name="TopOfPage"></a>
<pre>
/**************************************************************************
 * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
 *                                                                        *
 * Author: The ALICE Off-line Project.                                    *
 * Contributors are mentioned in the code where appropriate.              *
 *                                                                        *
 * Permission to use, copy, modify and distribute this software and its   *
 * documentation strictly for non-commercial purposes is hereby granted   *
 * without fee, provided that the above copyright notice appears in all   *
 * copies and that both the copyright notice and this permission notice   *
 * appear in the supporting documentation. The authors make no claims     *
 * about the suitability of this software for any purpose. It is          *
 * provided "as is" without express or implied warranty.                  *
 **************************************************************************/

/* $Id$ */

<b>//_________________________________________________________________________</b>
<b>// Implementation version v0 of PHOS Manager class </b>
<b>// Layout EMC + PPSD has name GPS2  </b>
<b>// The main goal of this version of <a href=".././AliPHOS.html">AliPHOS</a> is to calculte the </b>
<b>//  induced charged in the PIN diode, taking into account light</b>
<b>//  tracking in the PbWO4 crystal, induced signal in the </b>
<b>//  PIN due to MIPS particle and electronic noise.</b>
<b>// This is done in the StepManager </b>
<b>//                  </b>
<b>//*-- Author:  Odd Harald Oddland &amp; Gines Martinez (SUBATECH)</b>


<b>// --- ROOT system ---</b>
#include "TRandom.h"

<b>// --- Standard library ---</b>

#include &lt;cstdio&gt;
#include &lt;cstring&gt;
#include &lt;cstdlib&gt;
#include &lt;strstream&gt;

<b>// --- AliRoot header files ---</b>

#include "<a href="../AliPHOSv1.h">AliPHOSv1.h</a>"
#include "<a href="../AliPHOSHit.h">AliPHOSHit.h</a>"
#include "<a href="../AliPHOSDigit.h">AliPHOSDigit.h</a>"
#include "AliRun.h"
#include "AliConst.h"

ClassImp(AliPHOSv1)

<b>//____________________________________________________________________________</b>
<a name="AliPHOSv1:AliPHOSv1"> </a><a href=".././AliPHOSv1.html#AliPHOSv1:AliPHOSv1">AliPHOSv1::AliPHOSv1</a>(const <a href="../ListOfTypes.html#char">char</a> *name, const <a href="../ListOfTypes.html#char">char</a> *title):
  <a href=".././AliPHOSv0.html">AliPHOSv0</a>(name,title)
{
<b>  // ctor </b>

<b>  // Number of electrons created in the PIN due to light collected in the PbWo4 crystal is calculated using </b>
<b>  // following formula</b>
<b>  // NumberOfElectrons = EnergyLost * LightYield * PINEfficiency * </b>
<b>  //                     exp (-LightYieldAttenuation * DistanceToPINdiodeFromTheHit) *</b>
<b>  //                     RecalibrationFactor ;</b>
<b>  // LightYield is obtained as a Poissonian distribution with a mean at 700000 photons per GeV fromValery Antonenko</b>
<b>  // PINEfficiency is 0.1875 from Odd Harald Odland work</b>
<b>  // k_0 is 0.0045 from Valery Antonenko </b>

  <a href=".././AliPHOSv1.html#AliPHOSv1:fLightYieldMean">fLightYieldMean</a> = 700000. ;
  <a href=".././AliPHOSv1.html#AliPHOSv1:fIntrinsicPINEfficiency">fIntrinsicPINEfficiency</a> = 0.1875 ;
  <a href=".././AliPHOSv1.html#AliPHOSv1:fLightYieldAttenuation">fLightYieldAttenuation</a> = 0.0045 ;
  <a href=".././AliPHOSv1.html#AliPHOSv1:fRecalibrationFactor">fRecalibrationFactor</a> = 6.2 / <a href=".././AliPHOSv1.html#AliPHOSv1:fLightYieldMean">fLightYieldMean</a> ;
  <a href=".././AliPHOSv1.html#AliPHOSv1:fElectronsPerGeV">fElectronsPerGeV</a> = 2.77e+8 ; 
}

<b>//____________________________________________________________________________</b>
<a name="AliPHOSv1:AliPHOSv1"> </a><a href=".././AliPHOSv1.html#AliPHOSv1:AliPHOSv1">AliPHOSv1::AliPHOSv1</a>(<a href=".././AliPHOSReconstructioner.html">AliPHOSReconstructioner</a> * Reconstructioner, const <a href="../ListOfTypes.html#char">char</a> *name, const <a href="../ListOfTypes.html#char">char</a> *title):
  <a href=".././AliPHOSv0.html">AliPHOSv0</a>(Reconstructioner,name,title)
{
<b>  // ctor </b>

<b>  // Number of electrons created in the PIN due to light collected in the PbWo4 crystal is calculated using </b>
<b>  // following formula</b>
<b>  // NumberOfElectrons = EnergyLost * LightYield * PINEfficiency * </b>
<b>  //                     exp (-LightYieldAttenuation * DistanceToPINdiodeFromTheHit) *</b>
<b>  //                     RecalibrationFactor ;</b>
<b>  // LightYield is obtained as a Poissonian distribution with a mean at 700000 photons per GeV fromValery Antonenko</b>
<b>  // PINEfficiency is 0.1875 from Odd Harald Odland work</b>
<b>  // k_0 is 0.0045 from Valery Antonenko </b>

  <a href=".././AliPHOSv1.html#AliPHOSv1:fLightYieldMean">fLightYieldMean</a> = 700000.;
  <a href=".././AliPHOSv1.html#AliPHOSv1:fIntrinsicPINEfficiency">fIntrinsicPINEfficiency</a> = 0.1875 ;
  <a href=".././AliPHOSv1.html#AliPHOSv1:fLightYieldAttenuation">fLightYieldAttenuation</a> = 0.0045 ;
  <a href=".././AliPHOSv1.html#AliPHOSv1:fRecalibrationFactor">fRecalibrationFactor</a> = 6.2 / <a href=".././AliPHOSv1.html#AliPHOSv1:fLightYieldMean">fLightYieldMean</a> ;
  <a href=".././AliPHOSv1.html#AliPHOSv1:fElectronsPerGeV">fElectronsPerGeV</a> = 2.77e+8 ;
}

<b>//____________________________________________________________________________</b>
<a name="AliPHOSv1:StepManager"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././AliPHOSv1.html#AliPHOSv1:StepManager">AliPHOSv1::StepManager</a>(<a href="../ListOfTypes.html#void">void</a>)
{
<b>  // Accumulates hits as <a href="../ListOfTypes.html#long">long</a> as the track stays in a single crystal or PPSD gas Cell</b>
<b>  // Adds the energy deposited in the PIN diode</b>

  <a href="../ListOfTypes.html#Int_t">Int_t</a>          relid[4] ;      // (box, layer, row, column) indices
  <a href="../ListOfTypes.html#Float_t">Float_t</a>        xyze[4] ;       // position wrt MRS and energy deposited
  TLorentzVector pos ;
  <a href="../ListOfTypes.html#Int_t">Int_t</a> copy;
  <a href="../ListOfTypes.html#Float_t">Float_t</a>        lightyield ;   // Light Yield per GeV
  <a href="../ListOfTypes.html#Float_t">Float_t</a>        nElectrons ;   // Number of electrons in the PIN diode
  TString name = <a href=".././AliPHOSv0.html#AliPHOSv0:fGeom">fGeom</a>-&gt;GetName() ; 
  <a href="../ListOfTypes.html#Float_t">Float_t</a>        global[3] ;
  <a href="../ListOfTypes.html#Float_t">Float_t</a>        local[3] ;
  <a href="../ListOfTypes.html#Float_t">Float_t</a>        lostenergy ;

  <a href="../ListOfTypes.html#Int_t">Int_t</a> primary =  gAlice-&gt;GetPrimary( gAlice-&gt;CurrentTrack() ); 

  if ( name == "GPS2" ) { // the CPV is a PPSD
    if( gMC-&gt;CurrentVolID(copy) == gMC-&gt;VolId("GCEL") ) // We are inside a gas cell 
    {
      gMC-&gt;TrackPosition(pos) ;
      xyze[0] = pos[0] ;
      xyze[1] = pos[1] ;
      xyze[2] = pos[2] ;
      xyze[3] = gMC-&gt;Edep() ;


      if ( xyze[3] != 0 ) { // there is deposited energy 
       	gMC-&gt;CurrentVolOffID(5, relid[0]) ;  // get the PHOS Module number
       	gMC-&gt;CurrentVolOffID(3, relid[1]) ;  // get the Micromegas Module number 
<b>      // 1-&gt; Geom-&gt;GetNumberOfModulesPhi() *  <a href=".././AliPHOSv0.html#AliPHOSv0:fGeom">fGeom</a>-&gt;<a href=".././AliPHOSGeometry.html#AliPHOSGeometry:GetNumberOfModulesZ">GetNumberOfModulesZ</a>() upper                         </b>
<b>      //  &gt;  <a href=".././AliPHOSv0.html#AliPHOSv0:fGeom">fGeom</a>-&gt;<a href=".././AliPHOSGeometry.html#AliPHOSGeometry:GetNumberOfModulesPhi">GetNumberOfModulesPhi</a>()  *  <a href=".././AliPHOSv0.html#AliPHOSv0:fGeom">fGeom</a>-&gt;<a href=".././AliPHOSGeometry.html#AliPHOSGeometry:GetNumberOfModulesZ">GetNumberOfModulesZ</a>() lower</b>
       	gMC-&gt;CurrentVolOffID(1, relid[2]) ;  // get the row number of the cell
        gMC-&gt;CurrentVolID(relid[3]) ;        // get the column number 

<b>	// get the absolute Id number</b>

	<a href="../ListOfTypes.html#Int_t">Int_t</a> absid ; 
       	<a href=".././AliPHOSv0.html#AliPHOSv0:fGeom">fGeom</a>-&gt;<a href=".././AliPHOSGeometry.html#AliPHOSGeometry:RelToAbsNumbering">RelToAbsNumbering</a>(relid,absid) ; 
	

	AddHit(primary, absid, xyze );

      } // there is deposited energy 
     } // We are inside the gas of the CPV  
   } // GPS2 configuration
  
  if(gMC-&gt;CurrentVolID(copy) == gMC-&gt;VolId("PXTL") )//  We are inside a PBWO crystal 
     {
       gMC-&gt;TrackPosition(pos) ;
       xyze[0] = pos[0] ;
       xyze[1] = pos[1] ;
       xyze[2] = pos[2] ;
       lostenergy = gMC-&gt;Edep() ; 
       xyze[3] = gMC-&gt;Edep() ;

       global[0] = pos[0] ;
       global[1] = pos[1] ;
       global[2] = pos[2] ;

       if ( xyze[3] != 0 ) {
          gMC-&gt;CurrentVolOffID(10, relid[0]) ; // get the PHOS module number ;
          relid[1] = 0   ;                    // means PW04
          gMC-&gt;CurrentVolOffID(4, relid[2]) ; // get the row number inside the module
          gMC-&gt;CurrentVolOffID(3, relid[3]) ; // get the cell number inside the module

<b>      // get the absolute Id number</b>

          <a href="../ListOfTypes.html#Int_t">Int_t</a> absid ; 
          <a href=".././AliPHOSv0.html#AliPHOSv0:fGeom">fGeom</a>-&gt;<a href=".././AliPHOSGeometry.html#AliPHOSGeometry:RelToAbsNumbering">RelToAbsNumbering</a>(relid,absid) ; 
	  gMC-&gt;Gmtod(global, local, 1) ;
	  
<b>	  // calculating number of electrons in the PIN diode asociated to this hit</b>
	  lightyield = gRandom-&gt;Poisson(<a href=".././AliPHOSv1.html#AliPHOSv1:fLightYieldMean">fLightYieldMean</a>) ;
	  nElectrons = lostenergy * lightyield * <a href=".././AliPHOSv1.html#AliPHOSv1:fIntrinsicPINEfficiency">fIntrinsicPINEfficiency</a> *
	    exp(-<a href=".././AliPHOSv1.html#AliPHOSv1:fLightYieldAttenuation">fLightYieldAttenuation</a> * (local[1]+<a href=".././AliPHOSv0.html#AliPHOSv0:fGeom">fGeom</a>-&gt;<a href=".././AliPHOSGeometry.html#AliPHOSGeometry:GetCrystalSize">GetCrystalSize</a>(1)/2.0 ) ) ;

	  xyze[3] = nElectrons * <a href=".././AliPHOSv1.html#AliPHOSv1:fRecalibrationFactor">fRecalibrationFactor</a> ;
<b>	  // add current hit to the hit list</b>
          AddHit(primary, absid, xyze);
    
       } // there is deposited energy
    } // we are inside a PHOS Xtal

   if(gMC-&gt;CurrentVolID(copy) == gMC-&gt;VolId("PPIN") ) // We are inside de PIN diode 
     {
       gMC-&gt;TrackPosition(pos) ;
       xyze[0] = pos[0] ;
       xyze[1] = pos[1] ;
       xyze[2] = pos[2] ;
       lostenergy = gMC-&gt;Edep() ;
       xyze[3] = gMC-&gt;Edep() ;

       if ( xyze[3] != 0 ) {
          gMC-&gt;CurrentVolOffID(11, relid[0]) ; // get the PHOS module number ;
          relid[1] = 0   ;                    // means PW04 and PIN
          gMC-&gt;CurrentVolOffID(5, relid[2]) ; // get the row number inside the module
          gMC-&gt;CurrentVolOffID(4, relid[3]) ; // get the cell number inside the module

<b>      // get the absolute Id number</b>

          <a href="../ListOfTypes.html#Int_t">Int_t</a> absid ; 
          <a href=".././AliPHOSv0.html#AliPHOSv0:fGeom">fGeom</a>-&gt;<a href=".././AliPHOSGeometry.html#AliPHOSGeometry:RelToAbsNumbering">RelToAbsNumbering</a>(relid,absid) ;
	  
<b>	  // calculating number of electrons in the PIN diode asociated to this hit</b>
	  nElectrons = lostenergy * <a href=".././AliPHOSv1.html#AliPHOSv1:fElectronsPerGeV">fElectronsPerGeV</a> ;
	  xyze[3] = nElectrons * <a href=".././AliPHOSv1.html#AliPHOSv1:fRecalibrationFactor">fRecalibrationFactor</a> ;

<b>	  // add current hit to the hit list</b>
          AddHit(primary, absid, xyze);
<b>	  //printf("PIN volume is  %d, %d, %d, %d n",relid[0],relid[1],relid[2],relid[3]);</b>
<b>	  //printf("Lost energy in the PIN is %f n",lostenergy) ;</b>
       } // there is deposited energy
    } // we are inside a PHOS XtalPHOS PIN diode
}

</pre>

<!--SIGNATURE-->
<br>
<address>
<hr>
<center>
<a href="http://root.cern.ch/root/Welcome.html">ROOT page</a> - <a href="../ClassIndex.html">Class index</a> - <a href="#TopOfPage">Top of the page</a><br>
</center>
<hr>This page has been automatically generated. If you have any comments or suggestions about the page layout send a mail to <a href="mailto:rootdev@root.cern.ch">ROOT support</a>, or contact <a href="mailto:rootdev@root.cern.ch">the developers</a> with any questions or problems regarding ROOT.
</address>
</body>
</html>
