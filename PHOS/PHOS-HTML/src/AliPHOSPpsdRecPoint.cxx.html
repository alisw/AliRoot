<!DOCTYPE HTML PUBLIC "-// IETF/DTD HTML 2.0// EN">
<html>
<!--                                             -->
<!-- Author: ROOT team (rootdev@hpsalo.cern.ch)  -->
<!--                                             -->
<!--   Date: Thu Mar  9 00:11:50 2000            -->
<!--                                             -->
<head>
<title>AliPHOSPpsdRecPoint - source file</title>
<link rev=made href="mailto:rootdev@root.cern.ch">
<meta name="rating" content="General">
<meta name="objecttype" content="Manual">
<meta name="keywords" content="software development, oo, object oriented, unix, x11, motif, windows nt, c++, html, rene brun, fons rademakers">
<meta name="description" content="ROOT - An Object Oriented Framework For Large Scale Data Analysis.">
</head>
<body BGCOLOR="#ffffff" LINK="#0000ff" VLINK="#551a8b" ALINK="#ff0000" TEXT="#000000">
<a name="TopOfPage"></a>
<pre>
/**************************************************************************
 * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
 *                                                                        *
 * Author: The ALICE Off-line Project.                                    *
 * Contributors are mentioned in the code where appropriate.              *
 *                                                                        *
 * Permission to use, copy, modify and distribute this software and its   *
 * documentation strictly for non-commercial purposes is hereby granted   *
 * without fee, provided that the above copyright notice appears in all   *
 * copies and that both the copyright notice and this permission notice   *
 * appear in the supporting documentation. The authors make no claims     *
 * about the suitability of this software for any purpose. It is          *
 * provided "as is" without express or implied warranty.                  *
 **************************************************************************/

/* $Id$ */

<b>//_________________________________________________________________________</b>
<b>//  A RecPoint (cluster) in the PPSD </b>
<b>//  A PPSD RecPoint ends up to be a single digit</b>
<b>//                </b>
<b>//*--  Yves Schutz (SUBATECH)</b>

<b>// --- ROOT system ---</b>

#include "TPad.h"

<b>// --- Standard library ---</b>

#include &lt;iostream&gt;

<b>// --- AliRoot header files ---</b>

#include "<a href="../AliPHOSGeometry.h">AliPHOSGeometry.h</a>"
#include "<a href="../AliPHOSPpsdRecPoint.h">AliPHOSPpsdRecPoint.h</a>"
#include "AliRun.h"

ClassImp(AliPHOSPpsdRecPoint)

<b>//____________________________________________________________________________</b>
<a name="AliPHOSPpsdRecPoint:AliPHOSPpsdRecPoint"> </a><a href=".././AliPHOSPpsdRecPoint.html#AliPHOSPpsdRecPoint:AliPHOSPpsdRecPoint">AliPHOSPpsdRecPoint::AliPHOSPpsdRecPoint</a>(<a href="../ListOfTypes.html#void">void</a>)
{ 
<b>  // ctor</b>

  fMulDigit = 0 ;  
  <a href=".././AliPHOSGeometry.html">AliPHOSGeometry</a> * geom = <a href=".././AliPHOSGeometry.html#AliPHOSGeometry:GetInstance">AliPHOSGeometry::GetInstance</a>() ;  
  <a href=".././AliPHOSPpsdRecPoint.html#AliPHOSPpsdRecPoint:fDelta">fDelta</a> = geom-&gt;GetCrystalSize(0) ; 
  fLocPos.SetX(1000000.)  ;      //Local position should be evaluated
}

<b>//____________________________________________________________________________</b>
<a name="AliPHOSPpsdRecPoint:AddDigit"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././AliPHOSPpsdRecPoint.html#AliPHOSPpsdRecPoint:AddDigit">AliPHOSPpsdRecPoint::AddDigit</a>(AliDigitNew &amp; digit, <a href="../ListOfTypes.html#Float_t">Float_t</a> Energy)
{
<b>  // adds a digit to the digits list</b>
<b>  // and accumulates the total amplitude and the multiplicity </b>
  
  
  if ( fMulDigit &gt;= fMaxDigit ) { // increase the size of the lists 
    fMaxDigit*=2 ; 
    <a href="../ListOfTypes.html#int">int</a> * tempo = new ( <a href="../ListOfTypes.html#int">int</a>[fMaxDigit] ) ; 
    <a href="../ListOfTypes.html#Int_t">Int_t</a> index ; 
    
    for ( index = 0 ; index &lt; fMulDigit ; index++ )
      tempo[index] = fDigitsList[index] ;
    
    delete []  fDigitsList ; 
    fDigitsList =  new ( <a href="../ListOfTypes.html#int">int</a>[fMaxDigit] ) ;
   
    for ( index = 0 ; index &lt; fMulDigit ; index++ )
      fDigitsList[index] = tempo[index] ;
 
    delete [] tempo ;
  }

  fDigitsList[fMulDigit++]  =  (<a href="../ListOfTypes.html#int">int</a>) &amp;digit  ; 
  fAmp += Energy ; 
}

<b>//____________________________________________________________________________</b>
<a name="AliPHOSPpsdRecPoint:Compare"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././AliPHOSPpsdRecPoint.html#AliPHOSPpsdRecPoint:Compare">AliPHOSPpsdRecPoint::Compare</a>(TObject * obj)
{
<b>  // Compares according to the position</b>
  
  <a href="../ListOfTypes.html#Int_t">Int_t</a> rv ; 
  
  <a href=".././AliPHOSPpsdRecPoint.html">AliPHOSPpsdRecPoint</a> * clu = (<a href=".././AliPHOSPpsdRecPoint.html">AliPHOSPpsdRecPoint</a> *)obj ; 
  
 
  <a href="../ListOfTypes.html#Float_t">Float_t</a> x1 , z1 ;
  <a href="../ListOfTypes.html#Float_t">Float_t</a> x2 , z2 ;
  
  <a href="../ListOfTypes.html#Int_t">Int_t</a> phosmod1 ;
  <a href="../ListOfTypes.html#Int_t">Int_t</a> phosmod2 ;
  
  <a href="../ListOfTypes.html#Int_t">Int_t</a> up1 ;
  <a href="../ListOfTypes.html#Int_t">Int_t</a> up2 ; 
  
  if(<a href="#AliPHOSPpsdRecPoint:GetUp">GetUp</a>()) // upper layer
    up1 = 0 ; 
  else        // lower layer
    up1 = 1 ;       
  
  if(clu-&gt;<a href="#AliPHOSPpsdRecPoint:GetUp">GetUp</a>()) // upper layer
    up2 = 0 ; 
  else            // lower layer
    up2 = 1 ;       

  TVector3 posloc ;
  this-&gt;<a href="#AliPHOSPpsdRecPoint:GetLocalPosition">GetLocalPosition</a>(posloc) ;
  x1 = posloc.X() ;
  z1 = posloc.Z() ; 
  phosmod1 = this-&gt;GetPHOSMod();  
  clu-&gt;<a href="#AliPHOSPpsdRecPoint:GetLocalPosition">GetLocalPosition</a>(posloc) ;
  x2 = posloc.X() ;
  z2 = posloc.Z() ; 
  phosmod2 = clu-&gt;GetPHOSMod();

  if(phosmod1 == phosmod2 ) {
 
    if(up1 == up2 ){
      <a href="../ListOfTypes.html#Int_t">Int_t</a> rowdif = (<a href="../ListOfTypes.html#Int_t">Int_t</a>)TMath::Ceil(x1/<a href=".././AliPHOSPpsdRecPoint.html#AliPHOSPpsdRecPoint:fDelta">fDelta</a>) - (<a href="../ListOfTypes.html#Int_t">Int_t</a>) TMath::Ceil(x2/<a href=".././AliPHOSPpsdRecPoint.html#AliPHOSPpsdRecPoint:fDelta">fDelta</a>) ;

      if (rowdif&gt; 0) 
	rv = -1 ;
      else if(rowdif &lt; 0) 
	rv = 1 ;
      else if(z1&gt;z2) 
	rv = -1 ;
      else 
	rv = 1 ; 
    }

    else {

      if(up1 &lt; up2 ) // Upper level first (up = True or False, True &gt; False)
	rv = 1 ;   
      else 
	rv = - 1 ;
    }
    
  } // if phosmod1 == phosmod2

  else {

    if(phosmod1 &lt; phosmod2 ) 
      rv = -1 ;
    else 
      rv = 1 ;
  
}
  
  return rv ; 
}

<b>//____________________________________________________________________________</b>
<a name="AliPHOSPpsdRecPoint:GetLocalPosition"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././AliPHOSPpsdRecPoint.html#AliPHOSPpsdRecPoint:GetLocalPosition">AliPHOSPpsdRecPoint::GetLocalPosition</a>(TVector3 &amp;LPos)
{
<b>  // Calculates the local position in the PHOS-PPSD-module corrdinates</b>
  
  if( fLocPos.X() &lt; 1000000.) { //allready evaluated
   LPos = fLocPos ;
   return ;
  }

  <a href="../ListOfTypes.html#Int_t">Int_t</a> relid[4] ;

  <a href="../ListOfTypes.html#Float_t">Float_t</a> x = 0. ;
  <a href="../ListOfTypes.html#Float_t">Float_t</a> z = 0. ;

  <a href=".././AliPHOSGeometry.html">AliPHOSGeometry</a> * phosgeom = (<a href=".././AliPHOSGeometry.html">AliPHOSGeometry</a> *) fGeom ;
  
  <a href=".././AliPHOSDigit.html">AliPHOSDigit</a> * digit ;
  <a href="../ListOfTypes.html#Int_t">Int_t</a> iDigit;

  for(iDigit = 0; iDigit &lt; fMulDigit; iDigit++) {
    digit = (<a href=".././AliPHOSDigit.html">AliPHOSDigit</a> *) fDigitsList[iDigit]; 
 
    <a href="../ListOfTypes.html#Float_t">Float_t</a> xi ;
    <a href="../ListOfTypes.html#Float_t">Float_t</a> zi ;
    phosgeom-&gt;AbsToRelNumbering(digit-&gt;GetId(), relid) ;
    phosgeom-&gt;RelPosInModule(relid, xi, zi);
    x += xi ;
    z += zi ;
  }

  x /= fMulDigit ;
  z /= fMulDigit ;

  fLocPos.SetX(x)  ;
  fLocPos.SetY(0.) ;
  fLocPos.SetZ(z)  ;

  LPos = fLocPos ;

}

<b>//____________________________________________________________________________</b>
<a name="AliPHOSPpsdRecPoint:GetUp"> </a><a href="../ListOfTypes.html#Bool_t">Bool_t</a> <a href=".././AliPHOSPpsdRecPoint.html#AliPHOSPpsdRecPoint:GetUp">AliPHOSPpsdRecPoint::GetUp</a>() 
{
  <a href="../ListOfTypes.html#Int_t">Int_t</a> relid[4] ;
  
  <a href=".././AliPHOSGeometry.html">AliPHOSGeometry</a> * phosgeom = (<a href=".././AliPHOSGeometry.html">AliPHOSGeometry</a> *) fGeom ;
  
  <a href=".././AliPHOSDigit.html">AliPHOSDigit</a> *digit = (<a href=".././AliPHOSDigit.html">AliPHOSDigit</a> *)fDigitsList[0] ; 
  
  phosgeom-&gt;AbsToRelNumbering(digit-&gt;GetId(),relid);
  <a href="../ListOfTypes.html#Bool_t">Bool_t</a> up ;

  if((<a href="../ListOfTypes.html#Int_t">Int_t</a>)TMath::Ceil((<a href="../ListOfTypes.html#Float_t">Float_t</a>)relid[1]/
			(phosgeom-&gt;GetNumberOfModulesPhi()*phosgeom-&gt;GetNumberOfModulesZ())-0.0001 ) &gt; 1) 
    up = kFALSE ;
  else  
    up = kTRUE ;
  
  return up ;
}
<b>//______________________________________________________________________________</b>
<a name="AliPHOSPpsdRecPoint:Paint"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././AliPHOSPpsdRecPoint.html#AliPHOSPpsdRecPoint:Paint">AliPHOSPpsdRecPoint::Paint</a>(<a href="../ListOfTypes.html#Option_t">Option_t</a> *)
{
<b>  //*-*-*-*-*-*-*-*-*-*-*Paint this ALiRecPoint as a TMarker  with its current attributes*-*-*-*-*-*-*</b>
<b>  //*-*                  =============================================</b>

  TVector3 pos(0.,0.,0.) ;
  <a href="#AliPHOSPpsdRecPoint:GetLocalPosition">GetLocalPosition</a>(pos) ;
  <a href="../ListOfTypes.html#Coord_t">Coord_t</a> x = pos.X() ;
  <a href="../ListOfTypes.html#Coord_t">Coord_t</a> y = pos.Z() ;
  <a href="../ListOfTypes.html#Color_t">Color_t</a> markercolor = 1 ;
  <a href="../ListOfTypes.html#Size_t">Size_t</a>  markersize  = 1. ;
  <a href="../ListOfTypes.html#Style_t">Style_t</a> markerstyle = 2 ;
  if (<a href="#AliPHOSPpsdRecPoint:GetUp">GetUp</a>()) 
    markerstyle = 3 ;
  
  if (!gPad-&gt;IsBatch()) {
    gVirtualX-&gt;SetMarkerColor(markercolor);
    gVirtualX-&gt;SetMarkerSize (markersize);
    gVirtualX-&gt;SetMarkerStyle(markerstyle);
  }
  gPad-&gt;SetAttMarkerPS(markercolor,markerstyle,markersize);
  gPad-&gt;PaintPolyMarker(1,&amp;x,&amp;y,"");
  
  
}

<b>//____________________________________________________________________________</b>
<a name="AliPHOSPpsdRecPoint:Print"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././AliPHOSPpsdRecPoint.html#AliPHOSPpsdRecPoint:Print">AliPHOSPpsdRecPoint::Print</a>(<a href="../ListOfTypes.html#Option_t">Option_t</a> * option) 
{
<b>  // Print the digits information </b>
  
  cout &lt;&lt; "<a href=".././AliPHOSPpsdRecPoint.html">AliPHOSPpsdRecPoint</a>: " &lt;&lt; endl ;
  
  <a href=".././AliPHOSDigit.html">AliPHOSDigit</a> * digit ; 
  <a href="../ListOfTypes.html#Int_t">Int_t</a> iDigit;
  <a href=".././AliPHOSGeometry.html">AliPHOSGeometry</a> * phosgeom =  (<a href=".././AliPHOSGeometry.html">AliPHOSGeometry</a> *) fGeom ;

  <a href="../ListOfTypes.html#Float_t">Float_t</a> xi ;
  <a href="../ListOfTypes.html#Float_t">Float_t</a> zi ;
  <a href="../ListOfTypes.html#Int_t">Int_t</a> relid[4] ; 

  for(iDigit=0; iDigit&lt;fMulDigit; iDigit++) {
    digit = (<a href=".././AliPHOSDigit.html">AliPHOSDigit</a> *) fDigitsList[iDigit];
    phosgeom-&gt;AbsToRelNumbering(digit-&gt;GetId(), relid) ;
    phosgeom-&gt;RelPosInModule(relid, xi, zi);
    cout &lt;&lt; " Id = " &lt;&lt; digit-&gt;GetId() ;  
    cout &lt;&lt; "  Phos mod = " &lt;&lt; relid[0] ;  
    cout &lt;&lt; "  PPSD mod = " &lt;&lt; relid[1] ;  
    cout &lt;&lt; "  x = " &lt;&lt; xi ;  
    cout &lt;&lt; "  z = " &lt;&lt; zi ;  
    cout &lt;&lt; "   Energy = " &lt;&lt; digit-&gt;GetAmp() &lt;&lt; endl ;
  }
  cout &lt;&lt; "       Multiplicity    = " &lt;&lt; fMulDigit  &lt;&lt; endl ;
}


</pre>

<!--SIGNATURE-->
<br>
<address>
<hr>
<center>
<a href="http://root.cern.ch/root/Welcome.html">ROOT page</a> - <a href="../ClassIndex.html">Class index</a> - <a href="#TopOfPage">Top of the page</a><br>
</center>
<hr>This page has been automatically generated. If you have any comments or suggestions about the page layout send a mail to <a href="mailto:rootdev@root.cern.ch">ROOT support</a>, or contact <a href="mailto:rootdev@root.cern.ch">the developers</a> with any questions or problems regarding ROOT.
</address>
</body>
</html>
