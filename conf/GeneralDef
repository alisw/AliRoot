# $Id$
 
##### RULES #####
 
.SUFFIXES: .cxx .h

# IRST coding rule check
export IRST_INSTALLDIR=$(ALICE)/local/IRST
export CLASSPATH=$(IRST_INSTALLDIR)
STRIP=$(IRST_INSTALLDIR)/syntax/strip-cpp.prl
CODE_CHECK=java rules.RuleChecker
REV_ENG=$(IRST_INSTALLDIR)/scripts/revEng.sh

$(ALICE_ROOT)/include/%.h : %.h
	@[ -d $(dir $@) ] || mkdir $(dir $@)
	@cp -p $? $(ALICE_ROOT)/include
 
tgt_$(ALICE_TARGET)/%.o : %.cxx
	@[ -d $(dir $@) ] || mkdir -p $(dir $@)
ifeq ($(CXXVERBOSE),)
	@$(CXX) $(CXXFLAGS) -c $*.cxx -o tgt_$(ALICE_TARGET)/$*.o
else
	$(CXX) $(CXXFLAGS) -c $*.cxx -o tgt_$(ALICE_TARGET)/$*.o
endif

# IRST coding rule check 
check/%.i : %.cxx
	@[ -d $(dir $@) ] || mkdir -p $(dir $@)
	@$(CXX) -E $(CXXFLAGS) $*.cxx > check/$*.i

# IRST coding rule check
check/%.ii : check/%.i
	@$(STRIP) check/$*.i > check/$*.ii

# IRST coding rule check
check/%.viol : check/%.ii
	@$(CODE_CHECK) check/$*.ii ./ > check/$*.viol

tgt_$(ALICE_TARGET)/%.o : %.c
	@[ -d $(dir $@) ] || mkdir -p $(dir $@)
	@$(CC) $(CFLAGS) -c $*.c -o tgt_$(ALICE_TARGET)/$*.o

tgt_$(ALICE_TARGET)/%.o : %.f
	@[ -d $(dir $@) ] || mkdir -p $(dir $@)
	@$(F77) $(FFLAGS) -c $*.f -o tgt_$(ALICE_TARGET)/$*.o

tgt_$(ALICE_TARGET)/%.o : %.F
	@[ -d $(dir $@) ] || mkdir -p $(dir $@)
	@$(F77) $(FFLAGS) -c $*.F -o tgt_$(ALICE_TARGET)/$*.o

# Needed binary directories
LIBDIR = $(ALICE_ROOT)/lib/tgt_$(ALICE_TARGET)
BINDIR = $(ALICE_ROOT)/bin/tgt_$(ALICE_TARGET)


# Current Version

VERSION		= 3.03pre
 
# Which makedepend
MAKEDEPEND    = $(ROOTSYS)/bin/rmkdepend

# Root libraries
 
ROOTLIBS      = $(shell $(ROOTSYS)/bin/root-config --glibs) -lMinuit -lHtml
ROOTLIBS      := $(filter-out -lNew,$(ROOTLIBS))

# Alice libraries

ALILIBS	      = -L$(LIBDIR) -lMUON -lTPC -lPMD -lTRD -lFMD -lTOF \
                -lITS -lPHOS -lCASTOR -lRICH -lZDC -lSTRUCT \
                -lTGeant3 -lSTART -lEVGEN -lSTEER

# CERN Libraries 

CLIBS         = -lminicern

G3LIBS        = -lgeant321

